<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MarketBot Canvas</title>
    <script>
      (() => {
        try {
          const params = new URLSearchParams(window.location.search);
          const platform = (params.get("platform") || "").trim().toLowerCase();
          if (platform) {
            document.documentElement.dataset.platform = platform;
            return;
          }
          if (/android/i.test(navigator.userAgent || "")) {
            document.documentElement.dataset.platform = "android";
          }
        } catch (_) {}
      })();
    </script>
    <style>
      :root {
        color-scheme: light;
      }
      @media (prefers-reduced-motion: reduce) {
        body::before,
        body::after {
          animation: none !important;
        }
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        font:
          14px "Satoshi",
          "Avenir Next",
          "SF Pro Display",
          "Segoe UI Variable",
          "Helvetica Neue",
          sans-serif;
        background:
          radial-gradient(920px 720px at 18% 14%, rgba(56, 189, 248, 0.28), rgba(15, 23, 42, 0) 60%),
          radial-gradient(860px 680px at 82% 22%, rgba(59, 130, 246, 0.22), rgba(15, 23, 42, 0) 62%),
          radial-gradient(980px 880px at 52% 86%, rgba(14, 165, 233, 0.2), rgba(15, 23, 42, 0) 65%),
          #f8fafc;
        color: #0f172a;
        overflow: hidden;
      }
      :root[data-platform="android"] body {
        background:
          radial-gradient(920px 720px at 18% 14%, rgba(56, 189, 248, 0.38), rgba(15, 23, 42, 0) 60%),
          radial-gradient(860px 680px at 82% 22%, rgba(59, 130, 246, 0.32), rgba(15, 23, 42, 0) 62%),
          radial-gradient(980px 880px at 52% 86%, rgba(14, 165, 233, 0.3), rgba(15, 23, 42, 0) 65%),
          #eef2f7;
      }
      body::before {
        content: "";
        position: fixed;
        inset: -20%;
        background:
          repeating-linear-gradient(
            0deg,
            rgba(15, 23, 42, 0.04) 0,
            rgba(15, 23, 42, 0.04) 1px,
            transparent 1px,
            transparent 56px
          ),
          repeating-linear-gradient(
            90deg,
            rgba(15, 23, 42, 0.04) 0,
            rgba(15, 23, 42, 0.04) 1px,
            transparent 1px,
            transparent 56px
          );
        transform: translate3d(0, 0, 0) rotate(-7deg);
        will-change: transform, opacity;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        opacity: 0.16;
        pointer-events: none;
        animation: marketbot-grid-drift 140s ease-in-out infinite alternate;
      }
      :root[data-platform="android"] body::before {
        opacity: 0.28;
      }
      body::after {
        content: "";
        position: fixed;
        inset: -35%;
        background:
          radial-gradient(900px 700px at 28% 28%, rgba(56, 189, 248, 0.24), rgba(15, 23, 42, 0) 60%),
          radial-gradient(800px 650px at 72% 34%, rgba(59, 130, 246, 0.2), rgba(15, 23, 42, 0) 62%),
          radial-gradient(900px 800px at 55% 74%, rgba(14, 165, 233, 0.18), rgba(15, 23, 42, 0) 62%);
        filter: blur(32px);
        opacity: 0.5;
        will-change: transform, opacity;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
        transform: translate3d(0, 0, 0);
        pointer-events: none;
        animation: marketbot-glow-drift 110s ease-in-out infinite alternate;
      }
      :root[data-platform="android"] body::after {
        opacity: 0.68;
      }
      @supports (mix-blend-mode: multiply) {
        body::after {
          mix-blend-mode: multiply;
        }
      }
      @supports not (mix-blend-mode: multiply) {
        body::after {
          opacity: 0.58;
        }
      }
      @keyframes marketbot-grid-drift {
        0% {
          transform: translate3d(-12px, 8px, 0) rotate(-7deg);
          opacity: 0.4;
        }
        50% {
          transform: translate3d(10px, -7px, 0) rotate(-6.6deg);
          opacity: 0.56;
        }
        100% {
          transform: translate3d(-8px, 6px, 0) rotate(-7.2deg);
          opacity: 0.42;
        }
      }
      @keyframes marketbot-glow-drift {
        0% {
          transform: translate3d(-18px, 12px, 0) scale(1.02);
          opacity: 0.4;
        }
        50% {
          transform: translate3d(14px, -10px, 0) scale(1.05);
          opacity: 0.52;
        }
        100% {
          transform: translate3d(-10px, 8px, 0) scale(1.03);
          opacity: 0.43;
        }
      }
      canvas {
        position: fixed;
        inset: 0;
        display: block;
        width: 100vw;
        height: 100vh;
        touch-action: none;
        z-index: 1;
      }
      :root[data-platform="android"] #marketbot-canvas {
        background:
          radial-gradient(1100px 800px at 20% 15%, rgba(42, 113, 255, 0.78), rgba(0, 0, 0, 0) 58%),
          radial-gradient(900px 650px at 82% 28%, rgba(255, 0, 138, 0.66), rgba(0, 0, 0, 0) 62%),
          radial-gradient(1000px 900px at 60% 88%, rgba(0, 209, 255, 0.58), rgba(0, 0, 0, 0) 62%),
          #141c33;
      }
      #marketbot-status {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 24px;
        box-sizing: border-box;
        pointer-events: none;
        z-index: 3;
      }
      #marketbot-status .card {
        width: min(560px, 88vw);
        text-align: left;
        padding: 14px 16px 12px;
        border-radius: 18px;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.92), rgba(248, 250, 252, 0.9));
        border: 1px solid rgba(15, 23, 42, 0.12);
        box-shadow:
          0 18px 42px rgba(15, 23, 42, 0.18),
          inset 0 1px 0 rgba(255, 255, 255, 0.8);
        -webkit-backdrop-filter: blur(18px) saturate(140%);
        backdrop-filter: blur(18px) saturate(140%);
      }
      #marketbot-status .title {
        font:
          600 12px/1.2 "Satoshi",
          "Avenir Next",
          "SF Pro Text",
          "Segoe UI Variable",
          "Helvetica Neue",
          sans-serif;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: rgba(15, 23, 42, 0.6);
      }
      #marketbot-status .subtitle {
        margin-top: 8px;
        font:
          500 13px/1.45 "Satoshi",
          "Avenir Next",
          "SF Pro Text",
          "Segoe UI Variable",
          "Helvetica Neue",
          sans-serif;
        color: rgba(15, 23, 42, 0.88);
        white-space: pre-wrap;
        overflow-wrap: anywhere;
      }
      marketbot-a2ui-host {
        display: block;
        height: 100%;
        position: fixed;
        inset: 0;
        z-index: 4;
        --marketbot-a2ui-inset-top: 28px;
        --marketbot-a2ui-inset-right: 24px;
        --marketbot-a2ui-inset-bottom: 24px;
        --marketbot-a2ui-inset-left: 24px;
        --marketbot-a2ui-scroll-pad-bottom: 12px;
        --marketbot-a2ui-status-top: 18px;
        --marketbot-a2ui-empty-top: 18px;
      }
    </style>
  </head>
  <body>
    <canvas id="marketbot-canvas"></canvas>
    <div id="marketbot-status">
      <div class="card">
        <div class="title" id="marketbot-status-title">Ready</div>
        <div class="subtitle" id="marketbot-status-subtitle">Waiting for agent</div>
      </div>
    </div>
    <marketbot-a2ui-host></marketbot-a2ui-host>
    <script src="a2ui.bundle.js"></script>
    <script>
      (() => {
        const canvas = document.getElementById("marketbot-canvas");
        const ctx = canvas.getContext("2d");
        const statusEl = document.getElementById("marketbot-status");
        const titleEl = document.getElementById("marketbot-status-title");
        const subtitleEl = document.getElementById("marketbot-status-subtitle");
        const debugStatusEnabledByQuery = (() => {
          try {
            const params = new URLSearchParams(window.location.search);
            const raw = params.get("debugStatus") ?? params.get("debug");
            if (!raw) return false;
            const normalized = String(raw).trim().toLowerCase();
            return normalized === "1" || normalized === "true" || normalized === "yes";
          } catch (_) {
            return false;
          }
        })();
        let debugStatusEnabled = debugStatusEnabledByQuery;

        function resize() {
          const dpr = window.devicePixelRatio || 1;
          const w = Math.max(1, Math.floor(window.innerWidth * dpr));
          const h = Math.max(1, Math.floor(window.innerHeight * dpr));
          canvas.width = w;
          canvas.height = h;
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        window.addEventListener("resize", resize);
        resize();

        const setDebugStatusEnabled = (enabled) => {
          debugStatusEnabled = !!enabled;
          if (!statusEl) return;
          if (!debugStatusEnabled) {
            statusEl.style.display = "none";
          }
        };

        if (statusEl && !debugStatusEnabled) {
          statusEl.style.display = "none";
        }

        window.__marketbot = {
          canvas,
          ctx,
          setDebugStatusEnabled,
          setStatus: (title, subtitle) => {
            if (!statusEl || !debugStatusEnabled) return;
            if (!title && !subtitle) {
              statusEl.style.display = "none";
              return;
            }
            statusEl.style.display = "flex";
            if (titleEl && typeof title === "string") titleEl.textContent = title;
            if (subtitleEl && typeof subtitle === "string") subtitleEl.textContent = subtitle;
            if (!debugStatusEnabled) {
              clearTimeout(window.__statusTimeout);
              window.__statusTimeout = setTimeout(() => {
                statusEl.style.display = "none";
              }, 3000);
            } else {
              clearTimeout(window.__statusTimeout);
            }
          },
        };
      })();
    </script>
  </body>
</html>
